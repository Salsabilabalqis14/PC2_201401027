<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <title>UAS</title>
</head>
<body>
    <div class="container mt-4">
        <div class="row align-items-start">
            <div class="col-lg-8 col-md-12">
                <canvas id="canvas1" style="height: auto; max-width: 700px;"></canvas> <br>
                Threshold <br> 
                <input class="ms-4" type="range" min="0" max="255" id="threshold" value="0">
                <input type="text" id="threshold_val" size="3" disabled value="0" class="ms-3 mt-2" style="width: 60px;">&nbsp;
                <button id="thdefault" class="btn btn-primary ms-2">Reset</button><br> 
                Brightness <br> 
                <input class="ms-4" type="range" min="-255" max="255" data-id="4" id="brightness" value="0">
                <input type="text" id="brightness_val" size="3" disabled value="0" class="ms-3 mt-2" style="width: 60px;">&nbsp;
                <button id="brdefault" class="btn btn-primary ms-2">Reset</button><br>
                <hr>
                <button id="flip1" type="button" class="btn btn-primary" style="width: 150px;">Horizontal</button>
                <button id="flip2" type="button" class="btn btn-primary ms-4" style="width: 150px;">Vertikal</button>
                <button id="flip3" type="button" class="btn btn-primary  ms-4" style="width: 150px;">Flip Gabungan</button>
                <hr>
                <button id="mirror1" type="button" class="btn btn-primary" style="width: 150px;">Mirroring</button>
                <button id="mirror2" type="button" class="btn btn-primary ms-4" style="width: 150px;">Y Mirroring</button>
                <hr>
                <input type="number" id="num" size="3" value="0" style="width: 150px;">
                <button id="mean" type="button" class="btn btn-primary ms-4" style="width: 150px;">Mean Filter</button>
                <button id="median" type="button" class="btn btn-primary ms-4" style="width: 150px;">Median FIlter</button>
                <hr>
                <button id="sobel" type="button" class="btn btn-primary" style="width: 150px;">Sobel</button>
                <button id="prewitt" type="button" class="btn btn-primary ms-4" style="width: 150px;">Prewitt</button>
                <hr>
                <button id="roberts" type="button" class="btn btn-primary" style="width: 150px;">Roberts</button>
                <button id="laplacian" type="button" class="btn btn-primary ms-4" style="width: 150px;">Laplacian</button>
                <hr>
                <button id="uts1" type="button" class="btn btn-success" style="width: 150px;">UTS 1</button>
                <button id="uts2" type="button" class="btn btn-success ms-4" style="width: 150px;">UTS 2</button>
                <button id="uts3" type="button" class="btn btn-success ms-4" style="width: 150px;">UTS 3</button>
                <hr>
                <button id="uas" type="button" class="btn btn-warning" style="width: 150px;">UAS</button>
                <hr>
            </div>
            <div class="col-4">
                <button id="read" type="button" class="btn btn-primary" style="width: 150px;">Read Image</button>
                <button id="ori" type="button" class="btn btn-primary ms-4" style="width: 150px;">Original Image</button>
                <hr>
                R <input type="range" min="-255" max="255" data-id="1" id="ch1"><input type="text" id="chv1" size="3" disabled value="0" class="ms-3 mt-2" style="width: 60px;"><br> 
                G <input type="range" min="-255" max="255" data-id="2" id="ch2"><input type="text" id="chv2" size="3" disabled value="0" class="ms-3 mt-2" style="width: 60px;"><br> 
                B <input type="range" min="-255" max="255" data-id="3" id="ch3"><input type="text" id="chv3" size="3" disabled value="0" class="ms-3 mt-2" style="width: 60px;"><br> 
                A <input type="range" min="0" max="255" data-id="4" id="ch4" value="255"><input type="text" id="chv4" size="3" disabled value="255" class="ms-3 mt-2" style="width: 60px;"><br> 
                <button id="default" type="button" class="btn btn-primary mt-4" style="width: 150px;">Default RGBA</button>
                <hr>
                <button id="negatif" type="button" class="btn btn-primary" style="width: 150px;">Negatif</button>
                <button id="grayscl" type="button" class="btn btn-primary ms-4" style="width: 150px;">Grayscl</button>
                <hr>
                <select name="" id="histval">
                    <option value="0">Red</option>
                    <option value="1">Green</option>
                    <option value="2">Blue</option>
                </select>
                <button id="hist1" type="button" class="btn btn-primary ms-2">Histogram</button>
                <canvas id="canvas2" class="mt-4" style="height: 202px;"></canvas>
                <br><br>
				Rotasi : <input type="text" id="rotate_val" size="3" disabled value="0">&#176<input type="range" min="0" max="360" id="rotate" value="0"><br>
				Translasi X : <input type="range" min="0" max="100" id="transx" value="0"><input type="text" id="transx_val" size="3" disabled value="0"><br>
				Translasi Y : <input type="range" min="0" max="100" id="transy" value="0"><input type="text" id="transy_val" size="3" disabled value="0"><br>
                Scale : <input type="range" min="1" max="10" id="scale" value="1" step="0.1"> <hr>
            </div>
        </div>
    </div>
</body>
<style>
    body{
        background: rgba(255, 255, 255, 1);
    }
    *{
        font-family: sans-serif;
    }
</style>
<script src="pc.js"></script>
<script>
    var canvas = document.getElementById('canvas1')
    var obj = new pc(canvas)
    obj.image2canvas("gb1.jpg")

    var canvas2 = document.getElementById('canvas2')
    var obj2 = new pc(canvas2)
    obj2.blank2canvas(100,100)

    var tes = new Array()
    document.getElementById('read').addEventListener('click', function(){
        tes = obj.image2read()
    })

    document.getElementById('ori').addEventListener('click', function(){
        obj.image2original()
    })

    function rgbachange(){
        // copy array to array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end copy

        for (var j = 0; j < tesbackup.length; j++){
            tesbackup[j][0] += parseInt(document.getElementById('ch1').value)
            tesbackup[j][1] += parseInt(document.getElementById('ch2').value)
            tesbackup[j][2] += parseInt(document.getElementById('ch3').value)
            tesbackup[j][3] = parseInt(document.getElementById('ch4').value)
        }
        
        for (var i = 1; i <= 4; i++){
            document.getElementById('chv' + i).value = document.getElementById('ch' + i).value
        }

        obj.array2canvas(tesbackup)
    }

    for (var i = 1; i <=4; i++){
        document.getElementById('ch' + i).addEventListener('input', function(){
            rgbachange()
        })
    }

    document.getElementById('default').addEventListener('click', function(){
        for (var i = 1; i <= 3; i++){
            document.getElementById('ch' + i).value = 0
        }
        document.getElementById('ch4').value = 255
        rgbachange()
    })

    document.getElementById('hist1').addEventListener('click', function(){
        var hist = obj.hist2read([parseInt(document.getElementById("histval").value)]) // call [R, G, B, A] as [0, 1, 2, 3], can input more than 1 but only [0..3] parameter only
        obj2.hist2canvas(hist[0], 10)
    })

    // threshold
    document.getElementById('thdefault').addEventListener('click', function(){
        document.getElementById('threshold').value = 0
        document.getElementById('threshold_val').value = 0
        rgbachange()
    })

    // brightness
    document.getElementById('brdefault').addEventListener('click', function(){
        document.getElementById('brightness').value = 0
        document.getElementById('brightness_val').value = 0
        rgbachange()
    })

    document.getElementById('negatif').addEventListener('click', function(){
        // copy array to array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy
        for (var i = 0; i < tesbackup.length; i++){
            tes[i][0] = (255 - tesbackup[i][0])
            tes[i][1] = (255 - tesbackup[i][1])
            tes[i][2] = (255 - tesbackup[i][2])
            tes[i][3] = tesbackup[i][3]
        }
        obj.array2canvas(tes)
    })

    document.getElementById('grayscl').addEventListener('click', function(){
        // copy array to array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy
        for (var i = 0; i < tesbackup.length; i++){
            var total = Math.floor((tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2])/3)
            tes[i][0] = total
            tes[i][1] = total
            tes[i][2] = total
            tes[i][3] = tesbackup[i][3]
        }
        obj.array2canvas(tes)
    })

    document.getElementById('threshold').addEventListener('input', function(){
        document.getElementById('threshold_val').value = this.value
        batas = parseInt(this.value)
        //copy array to array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for (var i = 0; i < tes.length; i++){
            gabung = Math.floor((tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2])/3)
            if (gabung < batas){
                gabung = 0
            }
            else {
                gabung = 255
            }

            tes[i][0] = gabung
            tes[i][1] = gabung
            tes[i][2] = gabung
            tes[i][3] = tes[i][3]
        }
        obj.array2canvas(tesbackup)
    })

    document.getElementById('brightness').addEventListener('input', function(){
        document.getElementById('brightness_val').value = this.value
        p = parseInt(this.value)

        // copy array to array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c ++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for (var i = 0; i < tes.length; i++){
            tesbackup[i][0] = (tes[i][0] + p)
            tesbackup[i][1] = (tes[i][1] + p)
            tesbackup[i][2] = (tes[i][2] + p)
            tesbackup[i][3] = tes[i][3]
        }

        obj.array2canvas(tesbackup)
    })

    // Flip Horizontal
    document.getElementById('flip1').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            posnow = obj.xy2i(obj.width-1-x, y)     // mengambil index array xy ke dalam koordinat xy
            tes[i][0] = tesbackup[posnow][0]
            tes[i][1] = tesbackup[posnow][1]
            tes[i][2] = tesbackup[posnow][2]
            tes[i][3] = tesbackup[posnow][3]
        }
        obj.array2canvas(tes)
    })

    // Flip Vertikal
    document.getElementById('flip2').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            posnow = obj.xy2i(x, obj.height-1-y)
            tes[i][0] = tesbackup[posnow][0]
            tes[i][1] = tesbackup[posnow][1]
            tes[i][2] = tesbackup[posnow][2]
            tes[i][3] = tesbackup[posnow][3]
        }
        obj.array2canvas(tes)
    })

    // Flip Gabungan
    document.getElementById('flip3').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            
            posnow = obj.xy2i(obj.width-1-x, obj.height-1-y)     // mengambil index array xy ke dalam koordinat xy
            tes[i][0] = tesbackup[posnow][0]
            tes[i][1] = tesbackup[posnow][1]
            tes[i][2] = tesbackup[posnow][2]
            tes[i][3] = tesbackup[posnow][3]
        }
        obj.array2canvas(tes)
    })

    // Efek Mirroring
    document.getElementById('mirror1').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var wnow = obj.width
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            if (x < wnow/2)
            {
                posnow = obj.xy2i(wnow-x-1, y)
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }
        }
        obj.array2canvas(tes)
    })


    // Efek Mirroring Y
    document.getElementById('mirror2').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var hnow = obj.height
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            if (y < hnow/2)
            {
                posnow = obj.xy2i(x, hnow-y-1)
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }
        }
        obj.array2canvas(tes)
    })

     // Mean Filtering
    document.getElementById('mean').addEventListener('click', function(){
        filtersize = parseInt(document.getElementById('num').value)
        if(filtersize % 2 == 0 || filtersize < 3){
            warning('Filer SIze must Odd Number and >= 3')
            return false
        }

        borderparam = (filtersize - 1)/2
        meandoubleparam = filtersize * filtersize

        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for(var i=0; i<tes.length; i++){
            xstart = obj.i2x(i) - borderparam
            xend = obj.i2x(i) + borderparam
            ystart = obj.i2y(i) - borderparam
            yend = obj.i2y(i) + borderparam

            red = 0
            green = 0
            blue = 0

            for(var yc=ystart; yc<=yend; yc++){
                for(var xc=xstart; xc<=xend; xc++){
                    if(yc>=0 && xc>=0 && xc<obj.width && yc<obj.height){
                        red += tesbackup[obj.xy2i(xc,yc)][0]
                        green += tesbackup[obj.xy2i(xc,yc)][1]
                        blue += tesbackup[obj.xy2i(xc,yc)][2]
                    }
                }
            }

            tes[i][0] = Math.floor(red/meandoubleparam)
            tes[i][1] = Math.floor(green/meandoubleparam)
            tes[i][2] = Math.floor(blue/meandoubleparam)
        }

        obj.array2canvas(tes)
     })

    // Median Filtering
    document.getElementById('median').addEventListener('click', function(){
        filtersize = parseInt(document.getElementById('num').value)
        if(filtersize % 2 == 0 || filtersize < 3){
            warning('Filer SIze must Odd Number and >= 3')
            return false
        }

        borderparam = (filtersize - 1)/2

        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        for(var i=0; i<tes.length; i++){
            xstart = obj.i2x(i) - borderparam
            xend = obj.i2x(i) + borderparam
            ystart = obj.i2y(i) - borderparam
            yend = obj.i2y(i) + borderparam

            red = new Array()
            green = new Array()
            blue = new Array()
            count = 0

            for(var yc=ystart; yc<=yend; yc++){
                for(var xc=xstart; xc<=xend; xc++){
                    if(yc>=0 && xc>=0 && xc<obj.width && yc<obj.height){
                        red.push(tesbackup[obj.xy2i(xc,yc)][0])
                        green.push(tesbackup[obj.xy2i(xc,yc)][1])
                        blue.push(tesbackup[obj.xy2i(xc,yc)][2])
                    }
                    count++
                }
            }

            red = arraysort(red)
            green = arraysort(green)
            blue = arraysort(blue)

            if(count % 2 == 0){
                param = count/2
            }
            else{
                param = (count - 1)/2
            }

            tes[i][0] = red[param]
            tes[i][1] = green[param]
            tes[i][2] = blue[param]

        }

        obj.array2canvas(tes)
    })

    document.getElementById('sobel').addEventListener('click',function(){
        var Gxtemp = new Array(4)
        var Gytemp = new Array(4)
        var G = new Array()
        var xpos =0
        var ypos = 0
        
        function cek(x,y,n){
            if(y>=0 && x>=00 && x<obj.width && y<obj.height) return parseInt(tes[obj.xy2i(x,y)])
            else return 0
        }

        for (var i=0;i<tes.length;i++){
            var Gtemp = new Array(4)
            xpos = obj.i2x(i)
            ypos = obj.i2y(i)
            for (var j=0;j<3;j++){
               
                Gxtemp[j] = (cek(xpos-1,ypos-1)*-1) + (cek(xpos-1,ypos)*-2) + (cek(xpos-1,ypos+1)*-1) + (cek(xpos+1,ypos-1)) + (cek(xpos+1,ypos)*2) + (cek(xpos+1,ypos+1))
                Gytemp[j] = (cek(xpos-1,ypos-1)*-1) + (cek(xpos,ypos-1)*-2) + (cek(xpos+1,ypos-1)*-1) + (cek(xpos-1,ypos+1)) + (cek(xpos,ypos+1)*2) + (cek(xpos+1,ypos+1))
                Gtemp[j] = Math.floor(Math.sqrt((parseInt(Gxtemp[j])*parseInt(Gxtemp[j])) + (parseInt(Gytemp[j])*parseInt(Gytemp[j]))))
            }

                    Gtemp[3] = tes[i][3]
                    G.push(Gtemp)
            }
            
            obj.array2canvas(G)

    })

    document.getElementById('prewitt').addEventListener('click',function(){
        var Gxtemp = new Array(4)
        var Gytemp = new Array(4)
        var G = new Array()
        var xpos =0
        var ypos = 0
        
        function cek(x,y,n){
            if(y>=0 && x>=00 && x<obj.width && y<obj.height) return parseInt(tes[obj.xy2i(x,y)])
            else return 0
        }

        for (var i=0;i<tes.length;i++){
            var Gtemp = new Array(4)
            xpos = obj.i2x(i)
            ypos = obj.i2y(i)
            for (var j=0;j<3;j++){
               
                Gxtemp[j] = (cek(xpos-1,ypos-1)*-1) + (cek(xpos-1,ypos)*-1) + (cek(xpos-1,ypos+1)*-1) + (cek(xpos+1,ypos-1)) + (cek(xpos+1,ypos)) + (cek(xpos+1,ypos+1))
                Gytemp[j] = (cek(xpos-1,ypos-1)*-1) + (cek(xpos,ypos-1)*-1) + (cek(xpos+1,ypos-1)*-1) + (cek(xpos-1,ypos+1)) + (cek(xpos,ypos+1)) + (cek(xpos+1,ypos+1))
                Gtemp[j] = Math.floor(Math.sqrt((parseInt(Gxtemp[j])*parseInt(Gxtemp[j])) + (parseInt(Gytemp[j])*parseInt(Gytemp[j]))))
            }

                Gtemp[3] = tes[i][3]
                G.push(Gtemp)
            }
            
        obj.array2canvas(G)
    })

    document.getElementById('roberts').addEventListener('click',function(){
        var Gxtemp = new Array(4)
        var Gytemp = new Array(4)
        var G = new Array()
        var xpos =0
        var ypos = 0
        
        function cek(x,y,n){
            if(y>=0 && x>=00 && x<obj.width && y<obj.height) return parseInt(tes[obj.xy2i(x,y)])
            else return 0
        }

        for (var i=0;i<tes.length;i++){
            var Gtemp = new Array(4)
            xpos = obj.i2x(i)
            ypos = obj.i2y(i)
            for (var j=0;j<3;j++){
               
                Gxtemp[j] = (cek(xpos,ypos)*-1) + (cek(xpos+1,ypos+1))
                Gytemp[j] = (cek(xpos+1,ypos)*-1) + (cek(xpos,ypos+1))
                Gtemp[j] = Math.floor(Math.sqrt((parseInt(Gxtemp[j])*parseInt(Gxtemp[j])) + (parseInt(Gytemp[j])*parseInt(Gytemp[j]))))
            }

                Gtemp[3] = tes[i][3]
                G.push(Gtemp)
        }
            
        obj.array2canvas(G)
    })

    // Laplacian
    document.getElementById('laplacian').addEventListener('click',function(){
         // copy array without reference
         tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var xpos = 0
        var ypos = 0
        
        function cek(x,y,n){
            if(y>=0 && x>=00 && x<obj.width && y<obj.height) return parseInt(tes[obj.xy2i(x,y)])
            else return 0
        }

        for (var i=0;i<tes.length;i++){
            xpos = obj.i2x(i)
            ypos = obj.i2y(i)
            for (var j=0;j<3;j++){
               tes[i][j] = (cek(xpos,ypos-1)*-1) + (cek(xpos-1,ypos)*-1) + (cek(xpos,ypos)*4) + (cek(xpos+1,ypos)*-1) + (cek(xpos,ypos+1)*-1)
            }
        }
            
        obj.array2canvas(tes)
    })

    // Rotasi
    document.getElementById('rotate').addEventListener('input', function(){
        angle = parseInt(this.value)
        document.getElementById('rotate_val').value = angle

        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var pusatx = obj.width/2
        var pusaty = obj.height/2
        
        var toRadians = function(x){
            return x * (Math.PI/180)
        }

        // rotate 
        for(var i=0; i<tesbackup.length; i++){
            var x = obj.i2x(i) - pusatx
            var y = obj.i2y(i) - pusaty
            var xnow = Math.floor((x * Math.cos(toRadians(angle))) - (y * Math.sin(toRadians(angle)))) + pusatx
            var ynow = Math.floor((x * Math.sin(toRadians(angle))) + (y * Math.cos(toRadians(angle)))) + pusatx
            var posnow = obj.xy2i(xnow, ynow)

            if(posnow >= 0 && posnow<tesbackup.length &&  (xnow >= 0 && xnow < obj.width) && (ynow >= 0 && ynow < obj.width)){
                tesbackup[i][0] = tes[posnow][0]
                tesbackup[i][1] = tes[posnow][1]
                tesbackup[i][2] = tes[posnow][2]
                tesbackup[i][3] = tes[posnow][3]
            }
            else {
                tesbackup[i][3] = 0
            }
        }

        obj.array2canvas(tesbackup)
    })

    function translate(){
        var txval = parseInt(document.getElementById('transx').value)
        var tyval = parseInt(document.getElementById('transy').value)
        var pixels = new Array(tes.length)
        for(var j=0; j<pixels.length; j++){
            pixels[j] = [0,0,0,0]
        }
        for(var i=0; i<tes.length; i++){
            var x = obj.i2x(i)
            var y = obj.i2y(i)
            var xnow = x - txval
            var ynow = y - tyval
            var posnow = obj.xy2i(xnow, ynow)

            if(posnow >= 0 && posnow<tesbackup.length &&  (xnow >= 0 && xnow < obj.width) && (ynow >= 0 && ynow < obj.width)){
                pixels[posnow][0] = tes[i][0]
                pixels[posnow][1] = tes[i][1]
                pixels[posnow][2] = tes[i][2]
                pixels[posnow][3] = tes[i][3]
            }
        }
        obj.array2canvas(pixels)
    }

    document.getElementById('transx').addEventListener('input', function(){
        xt = parseInt(this.value)
        document.getElementById('transx_val').value = xt
        translate()
    })

    document.getElementById('transy').addEventListener('input', function(){
        xt = parseInt(this.value)
        document.getElementById('transy_val').value = xt
        translate()
    })

    document.getElementById('default').addEventListener('input', function(){
        document.getElementById('angle').value = 0
        document.getElementById('rotate').value = 0
        document.getElementById('transx').value = 0
        document.getElementById('transy').value = 0
        translate()
    })

    // MODUL 8
    document.getElementById('scale').addEventListener('change',function(){ 
        var scaleval = 1/this.value
        var xpos = 0
        var ypos = 0
        var xnow = 0
        var ynow = 0
        var objW = obj.width
        var objH = obj.height

        //copy array to array without reference
        tesbackup = new Array()
        for(var c=0; c<tes.length; c++){ 
            temp = new Array() 
            for(var d=0; d<4; d++){
                temp.push(255)
            }
            tesbackup.push(temp)
            }
        //end of copy
        
        for(var i=0; i<tes.length; i++){ 
            xpos = obj.i2x(i) 
            ypos = obj.i2y(i)
            xnow = Math.round( (xpos-1)*(objW-1)/(scaleval*objW-1)+1 )
            ynow = Math.round( (ypos-1)*(objH-1)/(scaleval*objH-1)+1 )
            var posnow = obj.xy2i(xnow,ynow)
            if(posnow >= 0 && posnow < tesbackup.length && (xnow>=0 && xnow<obj.width) && (ynow>=0 && ynow<obj.height)){
                tesbackup[i][0] = tes[posnow][0]
                tesbackup[i][1] = tes[posnow][1]
                tesbackup[i][2] = tes[posnow][2]
            }
        }
        obj.array2canvas(tesbackup)
    })

    document.getElementById('default').addEventListener('click',function(){ 
        document.getElementById('scale').value = 0
    })

    // UTS 1
    document.getElementById('uts1').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var wnow = obj.width
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            if (x < wnow/2)
            {
                //posnow = obj.xy2i(wnow-x-1, y)
                tes[i][0] = (255 - tesbackup[i][0])
                tes[i][1] = (255 - tesbackup[i][1])
                tes[i][2] = (255 - tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }
        }
        obj.array2canvas(tes)
    })

    // UTS 2
    document.getElementById('uts2').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var wnow = obj.width
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            if (x < wnow/2)
            {
                posnow = obj.xy2i(x, obj.height-1-y)
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }
            if (x > wnow/2)
            {
                posnow = obj.xy2i(wnow-x-1, y)
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }
        }
        obj.array2canvas(tes)
    })

    // UTS 3
    document.getElementById('uts3').addEventListener('click', function(){
        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var wnow = obj.width
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)
            if (x < wnow/3)
            {
                tes[i][0] = (255 + tesbackup[i][0])
                tes[i][1] = (tesbackup[i][1])
                tes[i][2] = (tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }

            if ((x > wnow/3) && (x < wnow/1.5) )
            {
                tes[i][0] = (tesbackup[i][0])
                tes[i][1] = (255 + tesbackup[i][1])
                tes[i][2] = (tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }

            if ((x > wnow * 2/3))
            {
                tes[i][0] = (tesbackup[i][0])
                tes[i][1] = (tesbackup[i][1])
                tes[i][2] = (255 + tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }
        }
        obj.array2canvas(tes)
    })
    
     // UAS
    document.getElementById('uas').addEventListener('click', function(){

        // copy array without reference
        tesbackup = new Array()
        for (var c = 0; c < tes.length; c++){
            temp = new Array()
            for (var d = 0; d < 4; d++){
                temp.push(tes[c][d])
            }
            tesbackup.push(temp)
        }
        // end of copy

        var wnow = obj.width
        var hnow = obj.height
        for (var i = 0; i < tesbackup.length; i++){
            x = obj.i2x(i)  // mengambil nilai index array ke dalam koordinat x
            y = obj.i2y(i)

            var total = Math.floor((tesbackup[i][0] + tesbackup[i][1] + tesbackup[i][2])/3) // Untuk Grayscale
            
            // Negatif
            if ((x < wnow/4) && (y < hnow/2))
            {
                tes[i][0] = (255 - tesbackup[i][0])
                tes[i][1] = (255 - tesbackup[i][1])
                tes[i][2] = (255 - tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }
            
            // Grayscale
            if ((x > wnow/4) && (x < wnow/2) && (y < hnow/2))
            {
                tes[i][0] = total
                tes[i][1] = total
                tes[i][2] = total
                tes[i][3] = tesbackup[i][3]
            }

            // Flip Horizontal
            if ((x > wnow/2) && (x < wnow*3/4) && (y < hnow/2))
            {
                posnow = obj.xy2i(obj.width-1-x, y)
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }

            // Flip Gabungan
            if ((x > wnow*3/4) && (y < hnow/2))
            {
                posnow = obj.xy2i(obj.width-1-x, obj.height-1-y)     // mengambil index array xy ke dalam koordinat xy
                tes[i][0] = tesbackup[posnow][0]
                tes[i][1] = tesbackup[posnow][1]
                tes[i][2] = tesbackup[posnow][2]
                tes[i][3] = tesbackup[posnow][3]
            }

            if ((x > wnow/2) && (x < wnow*3/4) && (y > hnow/2))
            {
                tes[i][0] = (tesbackup[i][0])
                tes[i][1] = (255 + tesbackup[i][1])
                tes[i][2] = (tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }

            if ((x > wnow*3/4) && (y > hnow/2))
            {
                tes[i][0] = (tesbackup[i][0])
                tes[i][1] = (tesbackup[i][1])
                tes[i][2] = (255 + tesbackup[i][2])
                tes[i][3] = tesbackup[i][3]
            }
        }


        var xpos = 0
        var ypos = 0

        filtersize = 5;

        borderparam = (filtersize - 1)/2
        meandoubleparam = filtersize * filtersize
        
        function cek(x,y,n){
            if(y>=0 && x>=00 && x<obj.width && y<obj.height) return parseInt(tes[obj.xy2i(x,y)])
            else return 0
        }

        for (var i=0;i<tes.length;i++){
            xpos = obj.i2x(i)
            ypos = obj.i2y(i)
            x = obj.i2x(i) 
            y = obj.i2y(i)

            xstart = obj.i2x(i) - borderparam
            xend = obj.i2x(i) + borderparam
            ystart = obj.i2y(i) - borderparam
            yend = obj.i2y(i) + borderparam

            red = 0
            green = 0
            blue = 0

            // Laplacian
            if ((x < wnow/4) && (y > hnow/2))
            {
                for (var j=0;j<3;j++){
                    tes[i][j] = (cek(xpos,ypos-1)*-1) + (cek(xpos-1,ypos)*-1) + (cek(xpos,ypos)*4) + (cek(xpos+1,ypos)*-1) + (cek(xpos,ypos+1)*-1)
                }
            }

            // Mean Filtering
            if ((x > wnow/4) && (x < wnow/2) && (y > hnow/2))
            {
                xstart = obj.i2x(i) - borderparam
                xend = obj.i2x(i) + borderparam
                ystart = obj.i2y(i) - borderparam
                yend = obj.i2y(i) + borderparam

                red = 0
                green = 0
                blue = 0

                for(var yc=ystart; yc<=yend; yc++){
                    for(var xc=xstart; xc<=xend; xc++){
                        if(yc>=0 && xc>=0 && xc<obj.width && yc<obj.height){
                            red += tesbackup[obj.xy2i(xc,yc)][0]
                            green += tesbackup[obj.xy2i(xc,yc)][1]
                            blue += tesbackup[obj.xy2i(xc,yc)][2]
                        }
                    }
                }

                tes[i][0] = Math.floor(red/meandoubleparam)
                tes[i][1] = Math.floor(green/meandoubleparam)
                tes[i][2] = Math.floor(blue/meandoubleparam)
            }
        }

        obj.array2canvas(tes)
    })

</script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script>
</html>